{"version":3,"file":"component.esm.js","sources":["../lib/component.mjs"],"sourcesContent":["const __run__ = Symbol('__run__')\nconst __root__ = Symbol('__root__')\nconst __render__ = Symbol('__render__')\n\nexport const __state__ = Symbol('__state__')\nexport const __store__ = Symbol('__store__')\n\nconst __readonly__ = {\n  enumerable: false,\n  configurable: false,\n  writable: false\n}\n\n/**\n * Attach global store\n * @param store \n * @param property \n * @returns {Boolean}\n */\nexport function attachStore(store, property = __store__, onChange) {\n  // eslint-disable-next-line no-param-reassign\n  store.reflector = onChange || this.requestUpdate.bind(this)\n  Object.defineProperty(this, property, {\n    ...__readonly__,\n    value: store\n  })\n  return true\n}\n\n/**\n * Create local state of component. State changes initiate re-render\n * @param state \n * @param property \n * @param onChange \n */\nexport function createState(state, property = __state__, onChange) {\n  const self = this\n  const value = new Proxy({\n    ...state\n  }, {\n    /**\n     * \n     * @param target \n     * @param key \n     */\n    get(target, key) {\n      const property = target[key]\n      if (property) {\n        return property.value\n      }\n      return undefined\n    },\n    /**\n     * \n     * @param target \n     * @param key \n     * @param value \n     */\n    set(target, key, value) {\n      const property = target[key]\n      if (property && property.value !== value) {\n        if (property.type && typeof value !== typeof property.type()) {\n          throw new Error(`Wrong type of propery \"${key}\".`)\n        }\n        property.value = value\n        if (typeof onChange === 'function') {\n          onChange(value, key)\n        } else if (self.requestUpdate) {\n          self.requestUpdate(value, key)\n        }\n        return true\n      }\n      return false\n    }\n  })\n\n  Object.defineProperty(this, property, {\n    ...__readonly__,\n    value\n  })\n}\n\n\nexport default class Component extends HTMLElement {\n  /**\n   * \n   * @param name \n   * @param cls \n   * @param hot \n   */\n  static define(name, cls) {\n    if (!window.customElements.get(name)) {\n      window.customElements.define(name, cls)\n    }\n    /** nativepack.ignore */\n    // eslint-disable-next-line no-undef\n    else if (module && module.hot && module.hot.status && module.hot.status() === 'apply') { // Hot Module Replacement\n      Array\n        .from(document.querySelectorAll(name))\n        .forEach(node => {\n          // Swap prototype of instance with new one\n          // https://github.com/polleverywhere/hmr-custom-element\n          Object.setPrototypeOf(node, cls.prototype)\n          // re-render\n          if (node.requestUpdate) {\n            node.requestUpdate()\n          }\n        })\n    }\n    /** nativepack.ignore */\n    return cls\n  }\n\n  static get mode() {\n    return 'open'\n  }\n\n  /**\n   * @param {Function} func\n   */\n  static set render(func) {\n    if (typeof func === 'function') {\n      this[__render__] = func\n    }\n  }\n\n  /**\n   * @returns {Object|null}\n   */\n  get state() {\n    return this[__state__] || null\n  }\n\n  /**\n   * @returns {Object|null}\n   */\n  get store() {\n    return this[__store__] || null\n  }\n\n  /**\n   * \n   * @param args \n   */\n  constructor(...args) {\n    super(args)\n\n    const { state, mode, mixins, store } = this.constructor\n\n    if (typeof this.constructor[__render__] !== 'function') {\n      throw new Error('Renderer is undefined. For example set \"lit-html\" render function')\n    }\n\n    if (mode && typeof mode === 'string') {\n      this[__root__] = this.attachShadow({\n        mode\n      })\n    }\n\n    if (state && typeof state === 'object') {\n      createState.call(this, state)\n    }\n\n    if (store && typeof store === 'object') {\n      attachStore.call(this, store)\n    }\n\n    if (Array.isArray(mixins)) {\n      mixins.forEach(mixin => mixin.created && mixin.created.apply(this, args))\n    }\n\n    Component[__run__](['created'], this)\n  }\n\n  /**\n   * Component Lifecycles\n   * @param lifeCycles \n   * @param instance \n   * @param args \n   */\n  static [__run__](lifeCycles, instance, args) {\n    lifeCycles.forEach(\n      lifeCycle => instance[lifeCycle]\n        && typeof instance[lifeCycle] === 'function'\n        // eslint-disable-next-line prefer-spread\n        && instance[lifeCycle].apply(instance, args)\n    )\n  }\n\n  connectedCallback() {\n    const { mixins } = this.constructor\n\n    if (Array.isArray(mixins)) {\n      mixins.forEach(mixin => mixin.mounted && mixin.mounted.call(this))\n    }\n\n    Component[__run__](['mounted', 'requestUpdate'], this)\n  }\n\n  // Call unmount\n  disconnectedCallback() {\n    const { mixins } = this.constructor\n\n    if (Array.isArray(mixins)) {\n      mixins.forEach(mixin => mixin.unmounted && mixin.unmounted.call(this))\n    }\n\n    Component[__run__](['requestUpdate', 'unmounted'], this)\n  }\n\n  /**\n   * Trigger re-render of element\n   */\n  requestUpdate() {\n    const container = this.shadowRoot || this[__root__] || this\n    const renderer = this.constructor[__render__]\n    return new Promise((resolve, reject) => {\n      if (this.render) {\n        resolve(renderer(this.render(), container, {\n          eventContext: this\n        }))\n      } else {\n        reject(new Error('Render method is missing'))\n      }\n    })\n  }\n}\n"],"names":["__run__","Symbol","__root__","__render__","__state__","__store__","__readonly__","enumerable","configurable","writable","attachStore","store","property","onChange","reflector","this","requestUpdate","bind","Object","defineProperty","value","createState","state","self","Proxy","[object Object]","target","key","type","Error","Component","HTMLElement","name","cls","window","customElements","get","module","hot","status","Array","from","document","querySelectorAll","forEach","node","setPrototypeOf","prototype","define","mode","render","func","args","super","mixins","constructor","attachShadow","call","isArray","mixin","created","apply","lifeCycles","instance","lifeCycle","mounted","unmounted","container","shadowRoot","renderer","Promise","resolve","reject","eventContext"],"mappings":"AAAA,MAAMA,EAAUC,OAAO,WACjBC,EAAWD,OAAO,YAClBE,EAAaF,OAAO,cAEbG,EAAYH,OAAO,aACnBI,EAAYJ,OAAO,aAE1BK,EAAe,CACnBC,YAAY,EACZC,cAAc,EACdC,UAAU,GASL,SAASC,EAAYC,EAAOC,EAAWP,EAAWQ,GAOvD,OALAF,EAAMG,UAAYD,GAAYE,KAAKC,cAAcC,KAAKF,MACtDG,OAAOC,eAAeJ,KAAMH,EAAU,IACjCN,EACHc,MAAOT,KAEF,EASF,SAASU,EAAYC,EAAOV,EAAWR,EAAWS,GACvD,MAAMU,EAAOR,KACPK,EAAQ,IAAII,MAAM,IACnBF,GACF,CAMDG,IAAIC,EAAQC,GACV,MAAMf,EAAWc,EAAOC,GACxB,GAAIf,EACF,OAAOA,EAASQ,OAUpBK,IAAIC,EAAQC,EAAKP,GACf,MAAMR,EAAWc,EAAOC,GACxB,GAAIf,GAAYA,EAASQ,QAAUA,EAAO,CACxC,GAAIR,EAASgB,aAAeR,UAAiBR,EAASgB,OACpD,MAAM,IAAIC,MAAM,0BAA0BF,OAQ5C,OANAf,EAASQ,MAAQA,EACO,mBAAbP,EACTA,EAASO,EAAOO,GACPJ,EAAKP,eACdO,EAAKP,cAAcI,EAAOO,IAErB,EAET,OAAO,KAIXT,OAAOC,eAAeJ,KAAMH,EAAU,IACjCN,EACHc,MAAAA,IAKW,MAAMU,UAAkBC,YAOrCN,cAAcO,EAAMC,GAoBlB,OAnBKC,OAAOC,eAAeC,IAAIJ,GAKtBK,QAAUA,OAAOC,KAAOD,OAAOC,IAAIC,QAAkC,UAAxBF,OAAOC,IAAIC,UAC/DC,MACGC,KAAKC,SAASC,iBAAiBX,IAC/BY,QAAQC,IAGP3B,OAAO4B,eAAeD,EAAMZ,EAAIc,WAE5BF,EAAK7B,eACP6B,EAAK7B,kBAbXkB,OAAOC,eAAea,OAAOhB,EAAMC,GAkB9BA,EAGTgB,kBACE,MAAO,OAMTC,kBAAkBC,GACI,mBAATA,IACTpC,KAAKZ,GAAcgD,GAOvB7B,YACE,OAAOP,KAAKX,IAAc,KAM5BO,YACE,OAAOI,KAAKV,IAAc,KAO5BoB,eAAe2B,GACbC,MAAMD,GAEN,MAAM9B,MAAEA,EAAK2B,KAAEA,EAAIK,OAAEA,EAAM3C,MAAEA,GAAUI,KAAKwC,YAE5C,GAA4C,mBAAjCxC,KAAKwC,YAAYpD,GAC1B,MAAM,IAAI0B,MAAM,qEAGdoB,GAAwB,iBAATA,IACjBlC,KAAKb,GAAYa,KAAKyC,aAAa,CACjCP,KAAAA,KAIA3B,GAA0B,iBAAVA,GAClBD,EAAYoC,KAAK1C,KAAMO,GAGrBX,GAA0B,iBAAVA,GAClBD,EAAY+C,KAAK1C,KAAMJ,GAGrB6B,MAAMkB,QAAQJ,IAChBA,EAAOV,QAAQe,GAASA,EAAMC,SAAWD,EAAMC,QAAQC,MAAM9C,KAAMqC,IAGrEtB,EAAU9B,GAAS,CAAC,WAAYe,MASlCU,OAAQzB,GAAS8D,EAAYC,EAAUX,GACrCU,EAAWlB,QACToB,GAAaD,EAASC,IACc,mBAAxBD,EAASC,IAEhBD,EAASC,GAAWH,MAAME,EAAUX,IAI7C3B,oBACE,MAAM6B,OAAEA,GAAWvC,KAAKwC,YAEpBf,MAAMkB,QAAQJ,IAChBA,EAAOV,QAAQe,GAASA,EAAMM,SAAWN,EAAMM,QAAQR,KAAK1C,OAG9De,EAAU9B,GAAS,CAAC,UAAW,iBAAkBe,MAInDU,uBACE,MAAM6B,OAAEA,GAAWvC,KAAKwC,YAEpBf,MAAMkB,QAAQJ,IAChBA,EAAOV,QAAQe,GAASA,EAAMO,WAAaP,EAAMO,UAAUT,KAAK1C,OAGlEe,EAAU9B,GAAS,CAAC,gBAAiB,aAAce,MAMrDU,gBACE,MAAM0C,EAAYpD,KAAKqD,YAAcrD,KAAKb,IAAaa,KACjDsD,EAAWtD,KAAKwC,YAAYpD,GAClC,OAAO,IAAImE,QAAQ,CAACC,EAASC,KACvBzD,KAAKmC,OACPqB,EAAQF,EAAStD,KAAKmC,SAAUiB,EAAW,CACzCM,aAAc1D,QAGhByD,EAAO,IAAI3C,MAAM"}