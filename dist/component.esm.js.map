{"version":3,"file":"component.esm.js","sources":["../lib/component.mjs"],"sourcesContent":["const __run__ = Symbol('__run__')\nconst __root__ = Symbol('__root__')\nconst __tag__ = Symbol('__tag__')\nconst __render__ = Symbol('__render__')\n\nconst isTagName = /^(\\w+)-(\\w+)$/\n\nconst method = {\n  validate: Symbol('validate')\n}\n\nexport const __state__ = Symbol('__state__')\nexport const __store__ = Symbol('__store__')\n\nconst __readonly__ = {\n  enumerable: false,\n  configurable: false,\n  writable: false\n}\n\n/**\n * \n * @param func \n */\nfunction isFunc(func) {\n  return func && typeof func === 'function'\n}\n\n/**\n * \n * @param val1 \n * @param val2 \n */\nfunction isEqual(val1, val2) {\n  if (Object.is(val1, val2)) return true\n  if (isFunc(val1) && isFunc(val2)) return val1.toString() === val2.toString()\n  if (Object.is(JSON.stringify(val1), JSON.stringify(val2))) return true\n  return false\n}\n\n/**\n * Attach global store\n * @param store \n * @param property \n * @returns {Boolean}\n */\nexport function attachStore(store, property = __store__, onChange) {\n  // eslint-disable-next-line no-param-reassign\n  store.reflector = onChange || this.requestUpdate.bind(this)\n  Object.defineProperty(this, property, {\n    ...__readonly__,\n    value: store\n  })\n  return true\n}\n\n/**\n * Create local state of component. State changes initiate re-render\n * @param state \n * @param property \n * @param onChange \n */\nexport function createState(state, property = __state__, onChange) {\n  const self = this\n  const value = new Proxy({\n    ...state\n  }, {\n    /**\n     * \n     * @param target \n     * @param key \n     */\n    get(target, key) {\n      const property = target[key]\n      if (typeof property === 'object' && Object.prototype.hasOwnProperty.call(property, 'value')) {\n        return property.value\n      }\n      return undefined\n    },\n\n    /**\n     * \n     * @param target \n     * @param key \n     */\n    deleteProperty(target, key) {\n      delete target[key]\n      self.requestUpdate(undefined, key)\n      return true\n    },\n    /**\n     * \n     * @param target \n     * @param key \n     * @param value \n     */\n    set(target, key, value) {\n      const property = target[key]\n      if (typeof property === 'object' && !isEqual(property.value, value)) {\n        if (property.type && typeof value !== typeof property.type()) {\n          throw new TypeError(`Wrong type of propery \"${key}\".`)\n        }\n        property.value = value\n        if (typeof onChange === 'function') {\n          onChange(value, key)\n        } else if (self.requestUpdate) {\n          self.requestUpdate(value, key)\n        }\n        return true\n      }\n      return false\n    }\n  })\n\n  Object.defineProperty(this, property, {\n    ...__readonly__,\n    value\n  })\n}\n\n/**\n * \n */\nfunction bindRef() {\n  const self = this\n  Object.defineProperty(self, 'ref', {\n    ...__readonly__,\n    value: new Proxy({}, {\n      get(target, name) {\n        return self[__root__].querySelector('[ref=\"' + name + '\"]')\n      }\n    })\n  })\n}\n\n/**\n * \n */\nexport default class Component extends HTMLElement {\n  static set tagName(value) {\n    if (isTagName.test(value)) {\n      this[__tag__] = value\n    } else {\n      throw new Error('Wrong format of tag. Tag name should follow next format - `*-*` like app-drawer, etc... ')\n    }\n  }\n\n  static get tagName() {\n    return this[__tag__]\n  }\n\n  static get mode() {\n    return undefined\n  }\n\n  /**\n   * @param {Function} func\n   */\n  static set render(func) {\n    if (typeof func === 'function') {\n      this[__render__] = func\n    }\n  }\n\n  /**\n   * @returns {Object|null}\n   */\n  get state() {\n    return this[__state__] || null\n  }\n\n  /**\n   * @returns {Object|null}\n   */\n  get store() {\n    return this[__store__] || null\n  }\n\n  get root() {\n    return this[__root__]\n  }\n\n  /**\n   * \n   * @param args \n   */\n  constructor(...args) {\n    super(args)\n\n    const { state, mode, mixins, store, tagName } = this.constructor\n\n    if (!isTagName.test(tagName)) {\n      throw new Error('Static property tagName is required')\n    }\n\n    this[method.validate](state)\n\n    if (typeof this.constructor[__render__] !== 'function') {\n      throw new Error('Renderer is undefined. For example set \"lit-html\" render function')\n    }\n\n    if (['open', 'closed'].includes(mode)) {\n      this[__root__] = this.attachShadow({\n        mode\n      })\n    }\n\n    bindRef.call(this)\n\n    if (state && typeof state === 'object') {\n      createState.call(this, state)\n    }\n\n    if (store && typeof store === 'object') {\n      attachStore.call(this, store)\n    }\n\n    if (Array.isArray(mixins)) {\n      mixins.forEach(mixin => mixin.created && mixin.created.apply(this, args))\n    }\n\n    Component[__run__](['created'], this)\n  }\n\n  /**\n   * \n   * @param {String} tag \n   * @param {HTMLElement} point\n   * @param {Boolean} once \n   */\n  static mount(point = document.body, once = true) {\n    if (point instanceof HTMLElement && point.insertAdjacentHTML && this.tagName) {\n      if (once && document.querySelector(this.tagName)) {\n        return\n      }\n      point.insertAdjacentHTML('beforeend', `<${this.tagName} />`)\n    } else {\n      throw new Error('Static property tagName is required')\n    }\n  }\n\n  /**\n  * \n  * @param name \n  * @param cls \n  * @param hot \n  */\n  static define(name) {\n    this.tagName = name\n    if (!window.customElements.get(name)) {\n      window.customElements.define(name, this)\n    }\n    /** nativepack.ignore */\n    // eslint-disable-next-line no-undef\n    else if (module && module.hot && module.hot.status && module.hot.status() === 'apply') { // Hot Module Replacement\n      Array\n        .from(document.querySelectorAll(name))\n        .forEach(node => {\n          // Swap prototype of instance with new one\n          // https://github.com/polleverywhere/hmr-custom-element\n          Object.setPrototypeOf(node, this.prototype)\n          // re-render\n          if (node.requestUpdate) {\n            node.requestUpdate()\n          }\n        })\n    }\n    /** nativepack.ignore */\n    return this\n  }\n\n  /**\n   * Component Lifecycles\n   * @param lifeCycles \n   * @param instance \n   * @param args \n   */\n  static [__run__](lifeCycles, instance, args) {\n    lifeCycles.forEach(\n      lifeCycle => instance[lifeCycle]\n        && typeof instance[lifeCycle] === 'function'\n        // eslint-disable-next-line prefer-spread\n        && instance[lifeCycle].apply(instance, args)\n    )\n  }\n\n  /**\n   * Validate state types\n   */\n  [method.validate](state = {}) {\n    if (!state) return\n    const keys = Object.keys(state)\n    for (const key of keys) {\n      const property = state[key]\n\n      if (property.type && typeof property.value !== typeof property.type()) {\n        throw new TypeError(`Wrong type of propery \"${key}\".`)\n      }\n    }\n  }\n\n  adoptedCallback() {\n    const { mixins } = this.constructor\n\n    if (Array.isArray(mixins)) {\n      mixins.forEach(mixin => mixin.moved && mixin.moved.call(this))\n    }\n\n    Component[__run__](['moved', 'requestUpdate'], this)\n  }\n\n  connectedCallback() {\n    const { mixins } = this.constructor\n\n    if (Array.isArray(mixins)) {\n      mixins.forEach(mixin => mixin.mounted && mixin.mounted.call(this))\n    }\n\n    Component[__run__](['mounted', 'requestUpdate'], this)\n  }\n\n  attributeChangedCallback(...args) {\n    Component[__run__](['requestUpdate'], this)\n    isFunc(this.updated) && this.updated(...args)\n  }\n\n  // Call unmount\n  disconnectedCallback() {\n    const { mixins } = this.constructor\n\n    if (Array.isArray(mixins)) {\n      mixins.forEach(mixin => mixin.unmounted && mixin.unmounted.call(this))\n    }\n\n    Component[__run__](['unmounted'], this)\n  }\n\n  /**\n   * Trigger re-render of element\n   */\n  async requestUpdate() {\n    const container = this.shadowRoot || this.root || this\n    const renderer = this.constructor[__render__]\n\n    await Component[__run__](['beforeUpdate'], this)\n\n    const template = await this.render()\n\n    if (renderer) {\n      await renderer(template, container, {\n        eventContext: this\n      })\n    } else if (typeof template === 'string') {\n      container.innerHTML = template\n    }\n\n    Component[__run__](['afterUpdate'], this)\n  }\n}\n"],"names":["__run__","Symbol","__root__","__tag__","__render__","isTagName","method","__state__","__store__","__readonly__","enumerable","configurable","writable","isFunc","func","attachStore","store","property","onChange","reflector","this","requestUpdate","bind","Object","defineProperty","value","createState","state","self","Proxy","[object Object]","target","key","prototype","hasOwnProperty","call","deleteProperty","undefined","val1","val2","is","toString","JSON","stringify","type","TypeError","bindRef","get","name","querySelector","Component","HTMLElement","tagName","test","Error","mode","render","root","args","super","mixins","constructor","includes","attachShadow","Array","isArray","forEach","mixin","created","apply","point","document","body","once","insertAdjacentHTML","window","customElements","module","hot","status","from","querySelectorAll","node","setPrototypeOf","define","lifeCycles","instance","lifeCycle","keys","moved","mounted","updated","unmounted","container","shadowRoot","renderer","template","eventContext","innerHTML"],"mappings":"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"}